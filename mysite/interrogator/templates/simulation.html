<!DOCTYPE html>

<html lang-"en">

<head>
	<title>Interrogator</title>
	<meta clearset="utf-8" />
	{% load staticfiles %}
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" type="text/css"/>
	<script src="{% static 'js/bootstrap.min.js' %}"></script> 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<style type="text/css">
		body {background-color: white}
	</style>
</head>
<body>

<div class="container-fluid">

	<div class="row">
		<div class="col-sm-6">
			<h3>Interrogation Room</h3>
			<h4 style="float:left; margin-right:15px">Suspects:</h4>
			<div class="suspect_bar"></div>
			<iframe id='display_pic_pdf' src='/static/pdfs/gen/tenor.gif' frameborder="1" width="600" height="450"></iframe>
			<h3 id="conv_response"></h3>
			


			<div class="form-group">
				<label>Interrogate the suspect.</label>
				<textarea class="form-control" rows="2" cols="60" id="user_input" style="min-width:600px; min-height:50px; max-width:600px"></textarea>
			</div>
			<div class="form-group">
				<textarea  rows="15" cols="60" id="chatbox" style="min-width:600px; min-height:200px; max-width:600px; display:">{{response}}</textarea>
				<div class="leave_bar" style="float:right"></div>

			</div> 
		</div>

	    <div class="col-sm-6" >
	    	<h3 id="watson_response">Hello, I'm Watson!</h3>
	    	<div>
	    	<div class="buttons" style="min-height:34px">
	    		<div class="button_line">
	    			<input type="button" id="btn" value="Watson" style="background-color: #4db8ff;border: none;color: white;padding: 5px 15px;text-align: center;text-decoration: none;display: inline-block;font-size: 16px; margin:2px; margin-bottom:0px; border-top-left-radius: 5px; border-top-right-radius: 5px">
	    		</div>
			</div>

				<div style="max-width:600">
					<iframe id='display_pdf' src='/static/pdfs/watson_inverted.gif' frameborder="1" width="600" height="450"></iframe>
					<div class="button_history_holder" style="min-height: 25px">
						<div class="button_history" style="min-height: 25px;">
						</div>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label>Ask watson to get documents from the Filing Cabinets.</label>
				<textarea class="form-control" rows="1" cols="60" id="watson_input" style="min-width:600px; min-height:50px; max-width:600px"></textarea>
			</div>
			<div class="form-group">
				<label>Notebook.</label>
				<textarea class="form-control" rows="4" cols="60" id="notepad" style="min-width:600px; min-height:100px; max-width:600px"></textarea>
			</div>

	    </div>
	</div>
</div>


<script>
	$("#user_input").keypress(function(e) {
		if (e.keyCode == 13){
			e.preventDefault();
			$.ajax({
			  type: "GET",
			  url: "converse/",
			  data: {'user_input': $("#user_input").val()}
			}).done(function( resp ) {
			   $("#chatbox").val($("#chatbox").val() + '\n\n' + $("#user_input").val());
			   $("#chatbox").val($("#chatbox").val() + '\n\n' + resp);
			   $("#conv_response").html(resp);

			   $("#user_input").val('');
			});
		}
	});

	$("#watson_input").keypress(function(e) {
		if (e.keyCode == 13){
			e.preventDefault();
			$.ajax({
			  type: "GET",
			  url: "watson/",
			  data: {'user_input': $("#watson_input").val()}
			}).done(function( resp ) {
			   $("#watson_response").html(resp);
			   $("#watson_input").val('');
			   $.ajax({
				  type: "GET",
				  url: "watson_button_length/",
				  data: {}
				}).done(function( resp_len ) {
				   $("div.button_line").remove();
				   $("div.buttons").append("<div class='button_line'></div>");
				   for (i = 0; i < parseInt(resp_len); i++) { 
				   	$.ajax({
					  type: "GET",
					  url: "watson_button_label/",
					  data: {'user_input': i}
					}).done(function( resp1 ) {
						//button creation for each result
						var name = "btn_" + i;
					    var but = $('<input/>',
					    {
					        type: 'button',
					        id: resp1,
					        style: "background-color: #4CAF50;border: none;color: white;padding: 5px 15px;text-align: center;text-decoration: none;display: inline-block;font-size: 16px; margin:2px; margin-bottom:0px; border-top-left-radius: 5px; border-top-right-radius: 5px",
					        value: resp1.substring(0, resp1.length-4),
					        click: function () { 
					        	var x = this.id;
					        	$.ajax({
								  type: "GET",
								  url: "watson_button_respond/",
								  data: {'user_input': x}
								}).done(function( resp1 ) {
									$("#display_pdf").attr('src', resp1+"#toolbar=0&navpanes=0");

								});
								//History button creation
								var name = "btn_" + x;
					    		var but_hist = $('<input/>',
					    		{
					        		type: 'button',
					        		class: 'history',
					        		id: x,
					        		style: "background-color: #4CAF50;border: none;color: white;padding: 2px 6px;text-align: center;text-decoration: none;display: inline-block;font-size: 11px; margin:2px; margin-bottom:0px; border-radius: 5px",
					        		value: x.substring(0, x.length-4),
					        		click: function () { 
					        			var x = this.id;
					        			$.ajax({
								  			type: "GET",
								  			url: "watson_button_respond/",
								  			data: {'user_input': x}
										}).done(function( resp1 ) {
											$("#display_pdf").attr('src', "/static/pdfs/gen/"+x+"#toolbar=0&navpanes=0");
									
										});
									}
								});
								//remove buttons if too many are present
								$('div.button_history').append(but_hist);
								if($('div.button_history').children().length > 7){
									$('.history').first().remove();
								}
							}
					    });
					    $('div.button_line').append(but);
					});
				   }
				});
			});

		}
	});
	$("#btn_1").click(function(e) {
		e.preventDefault();
		$.ajax({
		  type: "GET",
		  url: "watson_button/",
		  data: {'user_input': 1}
			}).done(function( resp ) {
		});
	});
	var num_buttons_people = 4;
	var people = ["Jimmy", "Eduardo", "Gabriella", "Calum"];
	for(i = 0; i < people.length; i++){
		var name = "person" + i;
	    var but = $('<input/>',
	    {
	        type: 'button',
	        id: people[i],
	        style: "background-color: #4CAF50;border: none;color: white;padding: 5px 15px;text-align: center;text-decoration: none;display: inline-block;font-size: 16px; margin:2px; margin-bottom:0px; border-radius: 5px",
	        value: people[i],
	        click: function () { 
	        	var x = this.id;
	        	$.ajax({
				  type: "GET",
				  url: "converse/",
				  data: {'user_input': x}
				}).done(function( resp ) {
			   		$("#chatbox").val($("#chatbox").val() + '\n\n' + resp);
			   		$("#user_input").val('');
			   		$.ajax({
					  type: "GET",
					  url: "converse/",
					  data: {'user_input': x}
					}).done(function( resp ) {
				   		$("#chatbox").val($("#chatbox").val() + '\n\n' + resp);
				   		$("#user_input").val('');
				   		$("#display_pic_pdf").attr('src', "/static/pdfs/gen/"+x+".PNG");
				   		$("conv_response").html("You're now looking in the eyes of " + x);
					});
				});
			}
		});
		$('div.suspect_bar').append(but);

	}
	var name = "leave";
    var but_leave = $('<input/>',
    {
        type: 'button',
        id: name,
        style: "background-color: #FF0000;border: none;color: white;padding: 5px 15px;text-align: center;text-decoration: none;display: inline-block;font-size: 16px; margin:2px; margin-bottom:0px; border-radius: 5px;",
        value: "Exit Room",
        click: function () { 
        	var x = this.id;
        	$.ajax({
			  type: "GET",
			  url: "converse/",
			  data: {'user_input': x}
			}).done(function( resp ) {
		   		$("#chatbox").val($("#chatbox").val() + '\n\n' + resp);
		   		$("#user_input").val('');
			});
		}
	});
	$('div.leave_bar').append(but_leave);

	
</script>

</body>
</html>